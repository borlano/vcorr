<!DOCTYPE html>
<html lang="en">
    <head>
        <!--        <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">-->
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta name="description" content=""/>
        <meta name="author" content="Svetlana Sirayeva"/>

        <title>Скорость коррозии трубопроводов</title>

        <!-- Bootstrap core CSS -->
        <link href="css/bootstrap.css" rel="stylesheet"/>
        <link href="css/custom.css" rel="stylesheet"/>

        <!-- Custom styles for this template -->
        <link href="css/jumbotron-narrow.css" rel="stylesheet"/>
        <script type="text/javascript" charset="utf-8" src="js/jquery.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/jquery.flot.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/bootstrap.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/alg.js"></script>

        <script>window["_GOOG_TRANS_EXT_VER"] = "1";</script>
    </head>

    <body screen_capture_injected="true">

        <div class="container-narrow" style="max-width: 820px; padding: 0px 10px; border-left: 1px solid #b9b9b9; background-color: white; border-right: 1px solid #b9b9b9;">
            <div class="header">
                <!--                <ul class="nav nav-pills pull-right" style="margin-top: 25px;">
                                    <li><a href="#">Об авторе</a></li>
                                </ul>-->
                <!--                <h3 class="text-muted">Project name</h3>-->
                <img src="images/logo.gif" style="display: inline-block;
                     margin-bottom: 10px;" />
            </div>

            <div class="jumbotron">
                <h2>Модель расчета скорости коррозии трубопроводов</h2>
                <!--                <p class="lead">модель расчета скорости коррозии трубопроводов</p>
                                <p><a class="btn btn-large btn-success" href="http://examples.getbootstrap.com/jumbotron-narrow/index.html#">Sign up today</a></p>-->
            </div>

            <div class="row marketing">
                <div class="col-lg-6">
                    <span class="myBlock">
                        <h4>1. срок эксплуатации газопровода (Т, годы)</h4>
                        <p>от 0 до 100</p>
                        <p><input type="text" class="form-control" id="k1"></p>
                    </span>

                    <span class="myBlock" style="border: 2px salmon dashed; border-radius: 10px; display: inline-block; padding: 10px;">
                        2<br/>
                        <h4>давление (p, МПа)</h4>
                        <p><input type="text" class="form-control" id="p"></p>

                        <h4>наружный диаметр (Dn, мм)</h4>
                        <p><input type="text" class="form-control" id="Dn"></p>

                        <h4>номин. толщина стенки (&delta;, мм)</h4>
                        <p><input type="text" class="form-control" id="delta"></p>

                        <!--                        <h4>коэфф. линейного расширения металла трубы(&alpha;)</h4>
                                                <p><input type="text" class="form-control" id="alfa"></p>-->


                        <!--                        <h4>модуль Юнга стали (E, ГПа)</h4>
                                                <p><input type="text" class="form-control" id="E"></p>-->

                        <h4>темп. металла трубы (t, &deg; С)</h4>
                        <p><input type="text" class="form-control" id="t"></p>


                        <!--                        <h4>коэфф. Пуассона для стали (&mu;)</h4>
                                                <p><input type="text" class="form-control" id="mu"></p>-->


                        <span id="sigmaBlock" style="display: none;">

                        </span>

                    </span>

                    <span class="myBlock">

                        <h4>3. степень анаэробности грунта</h4>
                        <p>от 0 до 9</p>
                        <p><input type="text" class="form-control" id="k3"></p>
                    </span>

                    <span class="myBlock">

                        <h4>4. удельное электрическое сопротивление грунта (ρ, Ом·м)</h4>
                        <p>от 0 до 180</p>
                        <p><input type="text" class="form-control" id="k4"></p>
                    </span>

                    <span class="myBlock">

                        <h4>5. марка стали</h4>
                        <p>от 0 до 9</p>
                        <!--                        <p>-->
                        <!--                            <input type="text" class="form-control" id="k5">-->
                        <div>
                            <div class="input-group">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Выберите <span class="caret"></span></button>
                                    <ul class="dropdown-menu">
                                        <li><a onclick="$('#k5').val(0)" href="javascript: void()">некачественная</a></li>
                                        <li><a onclick="$('#k5').val(5)" href="javascript: void()">качественная</a></li>
                                        <li><a onclick="$('#k5').val(9)" href="javascript: void()">высококачественная</a></li>
                                    </ul>
                                </div><!-- /btn-group -->
                                <input type="text" id="k5" class="form-control">
                            </div><!-- /input-group -->
                        </div>
                        <!--                        </p>-->

                    </span>

                    <span class="myBlock">

                        <h4>6. ионная сила грунтовой влаги (μ, г-ион/куб.дм)</h4>
                        <p>от 0 до 4.5</p>
                        <p><input type="text" class="form-control" id="k6"></p>
                        <!--                        <div class="col-lg-6">
                                                    <div class="input-group">
                                                        <div class="input-group-btn">
                                                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Action <span class="caret"></span></button>
                                                            <ul class="dropdown-menu">
                                                                <li><a href="#">Action</a></li>
                                                                <li><a href="#">Another action</a></li>
                                                                <li><a href="#">Something else here</a></li>
                                                                <li class="divider"></li>
                                                                <li><a href="#">Separated link</a></li>
                                                            </ul>
                                                        </div> /btn-group 
                                                        <input type="text" class="form-control">
                                                    </div> /input-group 
                                                </div>-->
                    </span>



                </div>
                <div class="col-lg-6">

                    <span class="myBlock">
                        <h4>7. окислительно-восстановительный потенциал грунта, редокс-потенциал (E, В)</h4>
                        <p>от -0.1 до 0.55</p>
                        <p><input type="text" class="form-control" id="k7"></p>
                    </span>

                    <span class="myBlock">

                        <h4>8. средняя плотность катодного тока (I, А/кв.м)</h4>
                        <p>от 0 до 0.225</p>
                        <p><input type="text" class="form-control" id="k8"></p>
                    </span>

                    <span class="myBlock">

                        <h4>9. уровень рН грунта</h4>
                        <p>от 0 до 12</p>
                        <p><input type="text" class="form-control" id="k9"></p>
                    </span>

                    <span class="myBlock">

                        <h4>10. влажность грунта (W, %)</h4>
                        <p>от 0 до 40</p>
                        <p><input type="text" class="form-control" id="k10"></p>
                    </span>

                    <!--                    <span class="myBlock">-->

                    <!--                        <h4>11. температура стенки газопровода (t, °C)</h4>
                                            <p>от -40 до 40</p>
                                            <p><input type="text" class="form-control" id="k11"></p>-->

                    <span class="myBlock" style="border: 2px salmon dashed; border-radius: 10px; display: inline-block; padding: 10px;">
                        11<br/>
                        <h4>температура газа на выходе из ближайшей КС до участка (Tpr, &deg;C)</h4>
                        <p><input type="text" class="form-control" id="Tpr"></p>

                        <h4>массовый расход газа (м<sup>3</sup>/час)</h4>
                        <p><input type="text" class="form-control" id="M"></p>

                        <span style="display: none;">
                            <h4>удельная теплоемкость продукта</h4>
                            <p><input type="text" class="form-control" value="0.6" id="Cp"></p>

                        </span>

                        <h4>температура грунта (t, &deg; С)</h4>
                        <p><input type="text" class="form-control" id="Tgr"></p>

                        <h4>расстояние от КС до повреждения (x, м)</h4>
                        <p><input type="text" class="form-control" id="x"></p>

                        <span style="display: none;">
                            <h4>коэфф. теплопередачи </h4>
                            <p><input type="text" class="form-control" value="0.035" id="K"></p>
                        </span>


                        <!--                        <h4>диам. газопровода (Dn, м)</h4>
                                                <p><input type="text" class="form-control" id="Dn"></p>-->


                        <span id="sigmaBlock" style="display: none;">

                        </span>

                    </span>

                    <span class="myBlock">

                        <h4>Фактическая глубина коррозии стенки (мм)</h4>
                        <p></p>
                        <p><input type="text" class="form-control" id="Cfak"></p>
                    </span>

                    <!--                    </span>-->

                    <span class="myBlock">
                        <h4></h4>
                        <p style="visibility: hidden;">1</p>
                        <p style=""><button style="margin-top: -5px;" type="button" onclick="calculate()" class="btn btn-primary btn-block btn-lg">Рассчитать</button></p>
                    </span>

                </div>
            </div>


            <div style="margin: 0 auto; margin-bottom: 50px;" id="resultBlock" >
                <h1 style="text-align: center;">
                    Vcorr = <span style="font-weight: bold; border: dashed lightblue 2px; border-radius: 10px;" id="v">?</span>
                </h1>
                <h1 style="text-align: center;">
                    T = <span style="font-weight: bold; border: dashed lightblue 2px; border-radius: 10px;" id="Tost">?</span>
                </h1>
            </div>

            <div style="text-align: right;">
                <a href="#plots" onclick="drawAllPlots(); $(this).hide();" style="margin-left: 15px;color:rgb(119, 119, 119); margin-right: 15px; font-style: italic; " >показать графики терм-множеств</a>
            </div>

            <div style="display: none; width: 800px; height: auto; background-color: white; border-top: 3px solid #1c5da2 !important;" class="span12" id="plots" >

                <h2>Терм-множества</h2>
                <div class="pWrapper span4">
                    <b style="">1</b><br/>
                    <div id="plot0"></div>

                    <ul>
                        <li style="color: #e9ce7b;">
                            небольшой
                        </li>
                        <li style="color: #b7dcf8">
                            длительный
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>
                <div class="pWrapper span4">
                    <b style="">2</b><br/>
                    <div id="plot1"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            низкий
                        </li>
                        <li style="color: #b7dcf8">
                            средний
                        </li>
                        <li style="color: #d05d5d;">
                            повышенный
                        </li>
                        <li style="color: #4da74d;">
                            высокий
                        </li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">3</b><br/>
                    <div id="plot2"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            анаэробный
                        </li>
                        <li style="color: #b7dcf8">
                            аэробный
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">4</b><br/>
                    <div id="plot3"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            низкое
                        </li>
                        <li style="color: #b7dcf8">
                            среднее
                        </li>
                        <li style="color: #d05d5d;">
                            высокое
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">5</b><br/>
                    <div id="plot4"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            некачественная
                        </li>
                        <li style="color: #b7dcf8">
                            качественная
                        </li>
                        <li style="color: #d05d5d;">
                            высококачественная
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">6</b><br/>
                    <div id="plot5"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            низкая
                        </li>
                        <li style="color: #b7dcf8">
                            средняя
                        </li>
                        <li style="color: #d05d5d;">
                            высокая
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">7</b><br/>
                    <div id="plot6"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            крайне низкий
                        </li>
                        <li style="color: #b7dcf8">
                            низкий
                        </li>
                        <li style="color: #d05d5d;">
                            средний
                        </li>
                        <li style="color: #4da74d;">
                            высокий
                        </li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">8</b><br/>
                    <div id="plot7"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            низкая
                        </li>
                        <li style="color: #b7dcf8">
                            средняя
                        </li>
                        <li style="color: #d05d5d;">
                            высокая
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">9</b><br/>
                    <div id="plot8"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            кислый
                        </li>
                        <li style="color: #b7dcf8">
                            слабокислый
                        </li>
                        <li style="color: #d05d5d;">
                            нейтральный
                        </li>
                        <li style="color: #4da74d;">
                            слабощелочной
                        </li>
                        <li style="color: #9645ec;">
                            щелочной
                        </li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">10</b><br/>
                    <div id="plot9"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            сухой
                        </li>
                        <li style="color: #b7dcf8">
                            влажный
                        </li>
                        <li style="color: #d05d5d;">
                            особовлажный
                        </li>
                        <li class="voidLi"></li>
                        <li class="voidLi"></li>
                    </ul>
                </div>

                <div class="pWrapper span4">
                    <b style="">11</b><br/>
                    <div id="plot10"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            низкая
                        </li>
                        <li style="color: #b7dcf8">
                            средняя
                        </li>
                        <li style="color: #d05d5d;">
                            высокая
                        </li>
                        <li class="voidLi"></li>                    
                        <li  class="voidLi" ></li>

                    </ul>
                </div>
                <div class="pWrapper span4">
                    <b style="">Vcorr</b><br/>
                    <div id="plot11"></div>
                    <ul>
                        <li style="color: #e9ce7b;">
                            низкая
                        </li>
                        <li style="color: #b7dcf8">
                            умеренная
                        </li>
                        <li style="color: #d05d5d;">
                            средняя
                        </li>
                        <li style="color: #4da74d;">
                            повышенная
                        </li>
                        <li style="color: #9645ec;">
                            высокая
                        </li>
                    </ul>
                </div>


            </div>


            <div class="footer">
                <p style="margin-bottom: 0px;">Абдулино, 2013</p>
                <div style="display: block; height: 10px;"></div>
            </div>


        </div> <!-- /container -->
        <div id="spinner" class="spinner" style="display:none;">
            <img id="img-spinner" src="images/spinner.gif" alt="Loading"/>
        </div>



        <script>
            
            function isNumber(n) {
                return !isNaN(parseFloat(n)) && isFinite(n);
            }
            
            function assertBorders(from, to, x, id){
                if (x < from || x > to || x == undefined || !isNumber(x)){
                    failed = true;
                    $('#' + id).addClass('has-my-error');
                    alert('значение поля ' + id.substring(1) + " должно быть в пределах от " + from + " до " +to);
                }
            }
            
            function getData(){
                //                var alg = new Alg();
                failed = false;
                var a = new Array();
                var k1 = $('#k1').val();
                assertBorders(0, 100, k1, "k1");
                
                //                var k2 = $('#k2').val();
                //                assertBorders(0, 9, k2, "k2");
                var k2 = getSigma();
                
                var k3 = $('#k3').val();
                assertBorders(0, 9, k3, "k3");
                
                var k4 = $('#k4').val();
                assertBorders(0, 180, k4, "k4");
                
                var k5 = $('#k5').val();
                assertBorders(0, 9, k5, "k5");
                
                var k6 = $('#k6').val();
                assertBorders(0, 4.5, k6, "k6");
                
                var k7 = $('#k7').val();
                assertBorders(-0.1, 0.55, k7, "k7");
                
                var k8 = $('#k8').val();
                assertBorders(0, 0.225, k8, "k8");
                
                var k9 = $('#k9').val();
                assertBorders(0, 12, k9, "k9");
                
                var k10 = $('#k10').val();
                assertBorders(0, 40, k10, "k10");
                
                //                var k11 = $('#k11').val();
                //                assertBorders(-40, 40, k11, "k11");
                
                var k11 = getT();
                
                return k1 + "_" + k2 + "_" + k3 + "_" + k4 + "_" + k5 + "_" + k6 + "_" + k7 + "_" + k8 + "_" + k9 + "_" + k10 + "_" + k11;
            }
            
            function calculate(){
                $('.form-control').removeClass('has-my-error');
                $('#v').text("?");
                failed = false;
                var s = getData();
                if (failed == true){
                    return;
                }
                $("#spinner").show();
                $.ajax({
                    type: "GET",
                    url: "/SvetaProject/resources/algorithm/calc?data="+s,
                    success: function(data){
                        $("#spinner").hide();
                        var Vcorr = Math.floor(data * 100000) / 100000;
                        $('#v').text(Vcorr);
                        $('#resultBlock').show();
                        //                        var alg = new Alg();
                        var T = getTost(Vcorr);
                        $('#Tost').text(Math.floor(10.0 * T) / 10.0);
                        
                        
                    },
                    error: function(){
                        $("#spinner").hide();
                        alert('fail');
                    }
                });
            }
           
            function filterTenthGraph(data){
                var pointsNum = 300;
                var arr = new Array();
                for (var i in data){
                    arr.push(new Array());
                }
                
                for (var i = 0; i < pointsNum; i++){
                    for (var j in data){
                        if (data[j][i][0] <= 40){
                            arr[j].push(data[j][i]);
                        }
                    }
                }
                return arr;
            }
            
            function filterSecondGraph(data){
                var pointsNum = 300;
                for (var i = 0; i < pointsNum; i++){
                    for (var j in data){
                        data[j][i][0]*=40;
                        //                        if (data[j][i][0] <= 40){
                        //                            arr[j].push(data[j][i]);
                        //                        }
                    }
                }
                return data;
            }
            
            function loadGraph(id){
                $.ajax({
                    type: "GET",
                    url: "/SvetaProject/resources/algorithm/plot?id=" + id,
                    success: function(data){
                        $("#spinner").hide();
                        d = data;
                        
                        if (id == 9){
                            data = filterTenthGraph(data);
                        }
                        
                        if (id == 1){
                            data = filterSecondGraph(data);
                        }
                        
                        $.plot("#plot" + id, data);
                        console.log('id=' + id);
                        console.log(data);
                    },
                    error: function(){
                        $("#spinner").hide();
                        alert('plot: fail');
                    }
                });
            }
            
            function drawAllPlots(){
                $('#plots').show();
                for (var i = 0; i< 12; i++){
                    loadGraph(i);
                }
            }
            
            
            
            
        </script>


    </body>
</html>